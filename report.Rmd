---
title: "IN1119: Projeto Final"
subtitle: "Princípios e Técnicas da Análise Estatística Experimental"
author: "Daladier Delmiro, Rodrigo Bernardino, Rodrigo Valentim"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
    html_document:
        number_sections: TRUE
---

# Exploração de Dados: IDEB x Contas do Governo

Basic libraries for dealing with data:
```{r}
library(plotly)       # interactive graphs
library(RColorBrewer) # make new color sets
library(tidyverse)    # easy manipulation of dataframes
library(DT)           # generate interactive html tables
library(rvest)        # scrap web pages
source("utils.R")     # custom files with utilitary functions
```

Some libraries for better handling Rmarkdown:
```{r}
library(DT) # iteractive datatables
```

```{r include=FALSE}
# FILES CONSTANTS
base.dir <- "."
data.dir <- join.path(base.dir, "data")
output.dir <- join.path(base.dir, "results/")
```

```{r include=FALSE}
# some console printing setup
options(digits=4)
options(na.action = 'na.warn')
options(width=96) # max width in output/print commands
```

## Leitura dos Dados

Lê dados de contas do governo
```{r}
despesas.funcao.2018 <- read_csv2(
  join.path(data.dir, "tesouro-csv", "2018_Despesas-Funcao-ESTADOS.csv"),
  locale=locale(encoding="ISO-8859-15"),
  skip=3,
  col_types = cols(.default = col_factor(NULL),
                   "População" = col_number(),
                   Valor = col_number()))

datatable(despesas.funcao.2018, filter="top")
```

Lê dados do IDEB 4o-5o anos para cada estado, já foi convertido do HTML para CSV:
```{r}
# leitura do CSV extraído do HTML
estados45ano.df <- read_csv2(join.path(data.dir, "ideb/ideb-csv/ideb-estados-45ano.csv"))
estados89ano.df <- read_csv2(join.path(data.dir, "ideb/ideb-csv/ideb-estados-89ano.csv"))
datatable(estados45ano.df, options=list(scrollX=T), rownames=F, filter="top")
```

## Exploração Inicial
### Despesas por Função: 2018

```{r}
datatable(despesas.funcao.2018,
          rownames=F,
          filter="top",
          options=list(pageLength = 5, scrollX=T))
```

### Checando os tipos de despesa

```{r}
despesas.funcao.2018 %>%
  select(Conta) %>%
  unique() %>%
  datatable(rownames=F, filter="top")
```

### Visualizando População
```{r}
despesas.funcao.2018 %>%
  select(UF, População) %>%
  ggplot(aes(x=UF, y=População)) +
  geom_bar(stat = "identity")
```

### Visualizando os Investimentos

É aplicado um filtro para calcular a soma total de investimentos em educação de todo tipo "código inicia com 12"

```{r}
despesas.funcao.2018 %>%
  filter(startsWith(as.character(Conta), "12")) %>% # todas que começam com "12", "12.1234" etc.
  group_by(UF) %>%
  summarise(InvEduc = sum(Valor)) %>%
  ggplot(aes(x=UF, y=InvEduc)) +
  geom_bar(stat = "identity")
```

```{r}
despesas.funcao.2018 %>%
  filter(startsWith(as.character(Conta), "12")) %>%
  group_by(UF) %>%
  summarise(InvEduc = sum(Valor)) %>%
  ggplot(aes(x=UF, y=InvEduc)) +
  geom_bar(stat = "identity")
```